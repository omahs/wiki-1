"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[5101],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),l=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=l(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),u=l(n),m=r,h=u["".concat(s,".").concat(m)]||u[m]||d[m]||o;return n?a.createElement(h,i(i({ref:t},p),{},{components:n})):a.createElement(h,i({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=u;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:r,i[1]=c;for(var l=2;l<o;l++)i[l]=n[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},8446:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var a=n(7462),r=(n(7294),n(3905));const o={sidebar_position:9},i="Game of chance",c={unversionedId:"examples/game-of-chance",id:"examples/game-of-chance",title:"Game of chance",description:"img alt",source:"@site/docs/examples/game-of-chance.md",sourceDirName:"examples",slug:"/examples/game-of-chance",permalink:"/docs/examples/game-of-chance",draft:!1,editUrl:"https://github.com/gear-tech/wiki/edit/master/docs/examples/game-of-chance.md",tags:[],version:"current",sidebarPosition:9,frontMatter:{sidebar_position:9},sidebar:"tutorialSidebar",previous:{title:"Escrow",permalink:"/docs/examples/escrow"},next:{title:"Dutch Auction",permalink:"/docs/examples/dutch-auction"}},s={},l=[{value:"How to run",id:"how-to-run",level:2},{value:"\u2692\ufe0f Build program",id:"\ufe0f-build-program",level:3},{value:"\ud83c\udfd7\ufe0f Upload program",id:"\ufe0f-upload-program",level:3},{value:"\ud83d\udda5\ufe0f Run UI",id:"\ufe0f-run-ui",level:3},{value:"Program logic",id:"program-logic",level:2},{value:"Interface",id:"interface",level:2},{value:"Initialization",id:"initialization",level:3},{value:"Actions",id:"actions",level:3},{value:"Program metadata and state",id:"program-metadata-and-state",level:3},{value:"Source code",id:"source-code",level:2}],p={toc:l};function d(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"game-of-chance"},"Game of chance"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"img alt",src:n(8775).Z,width:"1200",height:"597"})),(0,r.kt)("p",null,"Game of chance is a simple game smart contract with the lottery logic."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Program source code avalible on ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/gear-dapps/game-of-chance"},"Github")),(0,r.kt)("li",{parentName:"ul"},"dApp UI ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/gear-dapps/game-of-chance/tree/master/frontend"},"Github"))),(0,r.kt)("h2",{id:"how-to-run"},"How to run"),(0,r.kt)("h3",{id:"\ufe0f-build-program"},"\u2692\ufe0f Build program"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Get the source code of ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/gear-dapps/game-of-chance"},"GOC contract")),(0,r.kt)("li",{parentName:"ul"},"Build contracts as described in ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/gear-dapps/game-of-chance/blob/master/README.md"},"program/README.md"),".")),(0,r.kt)("h3",{id:"\ufe0f-upload-program"},"\ud83c\udfd7\ufe0f Upload program"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"You can deploy program using ",(0,r.kt)("a",{parentName:"li",href:"https://idea.gear-tech.io/"},"idea.gear-tech.io"),"."),(0,r.kt)("li",{parentName:"ol"},"In the network selector choose ",(0,r.kt)("inlineCode",{parentName:"li"},"Staging Testnet")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"Development")," (in this case, you should have a local node running)"),(0,r.kt)("li",{parentName:"ol"},"Upload prorgam ",(0,r.kt)("inlineCode",{parentName:"li"},"game_of_chance.opt.wasm")," from ",(0,r.kt)("inlineCode",{parentName:"li"},"/target/wasm32-unknown-unknown/release/")),(0,r.kt)("li",{parentName:"ol"},"Upload metadata file ",(0,r.kt)("inlineCode",{parentName:"li"},"meta.txt")),(0,r.kt)("li",{parentName:"ol"},"Specify ",(0,r.kt)("inlineCode",{parentName:"li"},"init payload")," and calculate gas!")),(0,r.kt)("h3",{id:"\ufe0f-run-ui"},"\ud83d\udda5\ufe0f Run UI"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Install packages as described in ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/gear-dapps/game-of-chance/blob/master/frontend/README.md"},"frontend/README.md")),(0,r.kt)("li",{parentName:"ol"},"Configure .evn file. Specify network address and program ID like in the example below:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"REACT_APP_NODE_ADDRESS=wss://node-workshop.gear.rs:443\nREACT_APP_CONTRACT_ADDRESS=0x45f48855184656f4fa7779e5ec0e3e54be8069a61cf62815e114d04d1b4916b4\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Run app")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"yarn start\n")),(0,r.kt)("h2",{id:"program-logic"},"Program logic"),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"For a more detailed technical description, see its ",(0,r.kt)("a",{parentName:"p",href:"https://dapps.gear.rs/game_of_chance"},"documentation on the dApps documentation portal")," and ",(0,r.kt)("a",{parentName:"p",href:"#source-code"},"the source code section"),".")),(0,r.kt)("p",null,"During an initialization, the game administrator is assigned. It has the rights to start a new game round and pick a winner after the end of each one. Other actors can participate in a round if they have enough fungible tokens or the native value, they're used to collect prize fund. After the end of the players entry stage, the administrator should execute the action for picking a winner, and this smart contract does it randomly and then sends prize fund to the winner."),(0,r.kt)("h2",{id:"interface"},"Interface"),(0,r.kt)("h3",{id:"initialization"},"Initialization"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"/// Initializes the Game of chance contract.\n///\n/// # Requirements\n/// - `admin` mustn't be [`ActorId::zero()`].\n#[derive(Debug, Default, Encode, Decode, PartialEq, Eq, PartialOrd, Ord, Clone, TypeInfo)]\npub struct GOCInit {\n    /// [`ActorId`] of the game administrator that'll have the rights to\n    /// [start a game round](GOCAction::Start) and\n    /// [pick a winner](GOCAction::PickWinner).\n    pub admin: ActorId,\n}\n")),(0,r.kt)("h3",{id:"actions"},"Actions"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"/// Sends a contract info about what it should do.\n#[derive(Debug, Encode, Decode, PartialEq, Eq, PartialOrd, Ord, Clone, Copy, TypeInfo)]\npub enum GOCAction {\n    /// Starts a game round and allows to participate in it.\n    ///\n    /// # Requirements\n    /// - [`msg::source()`](gstd::msg::source) must be the game administrator.\n    /// - The current game round must be over.\n    /// - `ft_actor_id` mustn't be [`ActorId::zero()`].\n    ///\n    /// On success, replies with [`GOCEvent::Started`].\n    Start {\n        /// The duration (in milliseconds) of the players entry stage.\n        ///\n        /// After that, no one will be able to enter a game round and a winner\n        /// should be picked.\n        duration: u64,\n        /// The price of participation in a game round.\n        participation_cost: u128,\n        /// A currency (or FT contract [`ActorId`]) of a game round.\n        ///\n        /// Determines fungible tokens in which a prize fund and a participation\n        /// cost will be collected. [`None`] means that the native value will be\n        /// used instead of fungible tokens.\n        ft_actor_id: Option<ActorId>,\n    },\n\n    /// Randomly picks a winner from current game round participants (players)\n    /// and sends a prize fund to it.\n    ///\n    /// The randomness of a winner pick depends on\n    /// [`exec::block_timestamp()`](gstd::exec::block_timestamp).\n    /// Not the best source of entropy, but, in theory, it's impossible to\n    /// exactly predict a winner if the time of an execution of this action is\n    /// unknown.\n    ///\n    /// If no one participated in the round, then a winner will be\n    /// [`ActorId::zero()`].\n    ///\n    /// # Requirements\n    /// - [`msg::source()`](gstd::msg::source) must be the game administrator.\n    /// - The players entry stage must be over.\n    /// - A winner mustn't already be picked.\n    ///\n    /// On success, replies with [`GOCEvent::Winner`].\n    PickWinner,\n\n    /// Pays a participation cost and adds [`msg::source()`] to the current game\n    /// round participants (players).\n    ///\n    /// A participation cost and its currency can be queried by the\n    /// `meta_state()` entry function.\n    ///\n    /// # Requirements\n    /// - The players entry stage mustn't be over.\n    /// - [`msg::source()`] mustn't already participate.\n    /// - [`msg::source()`] must have enough currency to pay a participation\n    /// cost.\n    /// - If the current game round currency is the native value (`ft_actor_id`\n    /// is [`None`]), [`msg::source()`] must send this action with the amount of\n    /// the value exactly equal to a participation cost.\n    ///\n    /// On success, replies with [`GOCEvent::PlayerAdded`].\n    ///\n    /// [`msg::source()`]: gstd::msg::source\n    Enter,\n}\n")),(0,r.kt)("h3",{id:"program-metadata-and-state"},"Program metadata and state"),(0,r.kt)("p",null,"Metadata interface description:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"pub struct ContractMetadata;\n\nimpl Metadata for ContractMetadata {\n    type Init = InOut<Initialize, Result<(), Error>>;\n    type Handle = InOut<Action, Result<Event, Error>>;\n    type Reply = ();\n    type Others = ();\n    type Signal = ();\n    type State = State;\n}\n")),(0,r.kt)("p",null,"To display the full contract state information, the ",(0,r.kt)("inlineCode",{parentName:"p"},"state()")," function is used:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},'#[no_mangle]\nextern "C" fn state() {\n    reply(common_state())\n        .expect("Failed to encode or reply with `<ContractMetadata as Metadata>::State` from `state()`");\n}\n')),(0,r.kt)("p",null,"To display only necessary certain values from the state, you need to write a separate crate. In this crate, specify functions that will return the desired values from the ",(0,r.kt)("inlineCode",{parentName:"p"},"State")," struct."),(0,r.kt)("h2",{id:"source-code"},"Source code"),(0,r.kt)("p",null,"The source code of the Game of chance smart contract and an implementation of its testing is available on ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/gear-dapps/game-of-chance"},"GitHub"),". They can be used as is or modified to suit your own scenarios."),(0,r.kt)("p",null,"For more details about testing smart contracts written on Gear, refer to the ",(0,r.kt)("a",{parentName:"p",href:"/docs/developing-contracts/testing"},"Program Testing")," article."))}d.isMDXComponent=!0},8775:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/goc-3627bed9e2b76919a9fc61148c164937.png"}}]);