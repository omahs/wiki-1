"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[4390],{3905:(e,n,a)=>{a.d(n,{Zo:()=>u,kt:()=>m});var t=a(7294);function s(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function r(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function o(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?r(Object(a),!0).forEach((function(n){s(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function i(e,n){if(null==e)return{};var a,t,s=function(e,n){if(null==e)return{};var a,t,s={},r=Object.keys(e);for(t=0;t<r.length;t++)a=r[t],n.indexOf(a)>=0||(s[a]=e[a]);return s}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(t=0;t<r.length;t++)a=r[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(s[a]=e[a])}return s}var l=t.createContext({}),d=function(e){var n=t.useContext(l),a=n;return e&&(a="function"==typeof e?e(n):o(o({},n),e)),a},u=function(e){var n=d(e.components);return t.createElement(l.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},g=t.forwardRef((function(e,n){var a=e.components,s=e.mdxType,r=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),g=d(a),m=s,p=g["".concat(l,".").concat(m)]||g[m]||c[m]||r;return a?t.createElement(p,o(o({ref:n},u),{},{components:a})):t.createElement(p,o({ref:n},u))}));function m(e,n){var a=arguments,s=n&&n.mdxType;if("string"==typeof e||s){var r=a.length,o=new Array(r);o[0]=g;var i={};for(var l in n)hasOwnProperty.call(n,l)&&(i[l]=n[l]);i.originalType=e,i.mdxType="string"==typeof e?e:s,o[1]=i;for(var d=2;d<r;d++)o[d]=a[d];return t.createElement.apply(null,o)}return t.createElement.apply(null,a)}g.displayName="MDXCreateElement"},7032:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>i,toc:()=>d});var t=a(7462),s=(a(7294),a(3905));const r={sidebar_position:10,sidebar_label:"Events"},o="Events",i={unversionedId:"api/events",id:"api/events",title:"Events",description:"Events are generated for certain operations during execution. The following sections describe events that are part of the default Gear runtime.",source:"@site/docs/api/events.mdx",sourceDirName:"api",slug:"/api/events",permalink:"/docs/api/events",draft:!1,editUrl:"https://github.com/gear-tech/wiki/edit/master/docs/api/events.mdx",tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10,sidebar_label:"Events"},sidebar:"tutorialSidebar",previous:{title:"Mailbox",permalink:"/docs/api/mailbox"},next:{title:"Cookbook",permalink:"/docs/api/extra-queries"}},l={},d=[{value:"Gear Events Types",id:"gear-events-types",level:2},{value:"MessageEnqueued",id:"messageenqueued",level:3},{value:"UserMessageSent",id:"usermessagesent",level:3},{value:"UserMessageSent",id:"usermessagesent-1",level:3},{value:"MessagesDispatched",id:"messagesdispatched",level:3},{value:"MessageWaited",id:"messagewaited",level:3},{value:"MessageWoken",id:"messagewoken",level:3},{value:"CodeChanged",id:"codechanged",level:3},{value:"ProgramChanged",id:"programchanged",level:3},{value:"Check what the event is",id:"check-what-the-event-is",level:2},{value:"Subscribe to specific gear events",id:"subscribe-to-specific-gear-events",level:2},{value:"Subscribe to messages sent from a program",id:"subscribe-to-messages-sent-from-a-program",level:3},{value:"Subscribe to messages intended for a program",id:"subscribe-to-messages-intended-for-a-program",level:3},{value:"Subscribe to Transfer events",id:"subscribe-to-transfer-events",level:3},{value:"Subscribe to new blocks",id:"subscribe-to-new-blocks",level:3}],u={toc:d};function c(e){let{components:n,...a}=e;return(0,s.kt)("wrapper",(0,t.Z)({},u,a,{components:n,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"events"},"Events"),(0,s.kt)("p",null,"Events are generated for certain operations during execution. The following sections describe events that are part of the default Gear runtime."),(0,s.kt)("p",null,"To subscribe to all events:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const unsub = await gearApi.query.system.events((events) => {\n  console.log(events.toHuman());\n});\n// Unsubscribe\nunsub();\n")),(0,s.kt)("h2",{id:"gear-events-types"},"Gear Events Types"),(0,s.kt)("h3",{id:"messageenqueued"},"MessageEnqueued"),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Summary:")," When a user successfully sends a message to a program and it gets added to the Gear message queue."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-rust"},"\nMessageEnqueued {\n    /// Generated id of the message.\n    id: MessageId,\n    /// Account id of the source of the message.\n    source: T::AccountId,\n    /// Program id, who is a destination of the message.\n    destination: ProgramId,\n    /// Entry point for processing of the message.\n    /// On the sending stage, processing function\n    /// of program is always known.\n    entry: Entry,\n}\n\n")),(0,s.kt)("h3",{id:"usermessagesent"},"UserMessageSent"),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Summary:")," When someone has sent a message to the user."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-rust"},"UserMessageSent {\n    /// Message sent.\n    message: StoredMessage,\n    /// Block number of expiration from `Mailbox`.\n    ///\n    /// Equals `Some(_)` with block number when message\n    /// will be removed from `Mailbox` due to some\n    /// reasons (see #642, #646 and #1010).\n    ///\n    /// Equals `None` if message wasn't inserted to\n    /// `Mailbox` and appears as only `Event`.\n    expiration: Option<T::BlockNumber>,\n}\n")),(0,s.kt)("h3",{id:"usermessagesent-1"},"UserMessageSent"),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Summary:"),' When a message has been marked as "read" and it has been removed from the ',(0,s.kt)("inlineCode",{parentName:"p"},"Mailbox"),". This event only affects messages, which were already prior inserted into the ",(0,s.kt)("inlineCode",{parentName:"p"},"Mailbox"),"."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-rust"},"UserMessageRead {\n    /// Id of the message read.\n    id: MessageId,\n    /// The reason of the reading (removal from `Mailbox`).\n    ///\n    /// NOTE: See more docs about reasons at `gear_common::event`.\n    reason: UserMessageReadReason,\n}\n")),(0,s.kt)("h3",{id:"messagesdispatched"},"MessagesDispatched"),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Summary:")," The result of when a message is processed within the block."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-rust"},"MessagesDispatched {\n    /// Total amount of messages removed from message queue.\n    total: MessengerCapacityOf<T>,\n    /// Execution statuses of the messages, which were already known\n    /// by `Event::MessageEnqueued` (sent from user to program).\n    statuses: BTreeMap<MessageId, DispatchStatus>,\n    /// Ids of programs, which state changed during queue processing.\n    state_changes: BTreeSet<ProgramId>,\n}\n")),(0,s.kt)("h3",{id:"messagewaited"},"MessageWaited"),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Summary:")," When a message's execution has been delayed and it has been added to the Gear waitlist."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-rust"},"MessageWaited {\n    /// Id of the message waited.\n    id: MessageId,\n    /// Origin message id, which started messaging chain with programs,\n    /// where currently waited message was created.\n    ///\n    /// Used for identifying by user, that this message associated\n    /// with him and with the concrete initial message.\n    origin: Option<MessageId>,\n    /// The reason of the waiting (addition to `Waitlist`).\n    ///\n    /// NOTE: See more docs about reasons at `gear_common::event`.\n    reason: MessageWaitedReason,\n    /// Block number of expiration from `Waitlist`.\n    ///\n    /// Equals block number when message will be removed from `Waitlist`\n    /// due to some reasons (see #642, #646 and #1010).\n    expiration: T::BlockNumber,\n}\n")),(0,s.kt)("h3",{id:"messagewoken"},"MessageWoken"),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Summary:")," When a message is ready to continue its execution and has been removed from the ",(0,s.kt)("inlineCode",{parentName:"p"},"Waitlist"),"."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-rust"},"MessageWoken {\n    /// Id of the message woken.\n    id: MessageId,\n    /// The reason of the waking (removal from `Waitlist`).\n    ///\n    /// NOTE: See more docs about reasons at `gear_common::event`.\n    reason: MessageWokenReason,\n}\n")),(0,s.kt)("h3",{id:"codechanged"},"CodeChanged"),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Summary:")," When a program's code has been altered."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-rust"},"CodeChanged {\n    /// Id of the code affected.\n    id: CodeId,\n    /// Change applied on code with current id.\n    ///\n    /// NOTE: See more docs about change kinds at `gear_common::event`.\n    change: CodeChangeKind<T::BlockNumber>,\n}\n")),(0,s.kt)("h3",{id:"programchanged"},"ProgramChanged"),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Summary:")," Any data related to program changed."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-rust"},"ProgramChanged {\n    /// Id of the program affected.\n    id: ProgramId,\n    /// Change applied on program with current id.\n    ///\n    /// NOTE: See more docs about change kinds at `gear_common::event`.\n    change: ProgramChangeKind<T::BlockNumber>,\n}\n")),(0,s.kt)("h2",{id:"check-what-the-event-is"},"Check what the event is"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"gearApi.query.system.events((events) => {\n  events\n    .filter(({ event }) => gearApi.events.gear.MessageEnqueued.is(event))\n    .forEach(({ event: { data } }) => {\n      console.log(data.toHuman());\n    });\n\n  events\n    .filter(({ event }) => gearApi.events.balances.Transfer.is(event))\n    .forEach(({ event: { data } }) => {\n      console.log(data.toHuman());\n    });\n});\n")),(0,s.kt)("h2",{id:"subscribe-to-specific-gear-events"},"Subscribe to specific gear events"),(0,s.kt)("h3",{id:"subscribe-to-messages-sent-from-a-program"},"Subscribe to messages sent from a program"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const unsub = api.gearEvents.subscribeToGearEvent(\n  'UserMessageSent',\n  ({\n    data: {\n      message: { id, source, destination, payload, value, reply },\n    },\n  }) => {\n    console.log(`\n  messageId: ${id.toHex()}\n  source: ${source.toHex()}\n  payload: ${payload.toHuman()}\n  `);\n  },\n);\n// Unsubscribe\nunsub();\n")),(0,s.kt)("h3",{id:"subscribe-to-messages-intended-for-a-program"},"Subscribe to messages intended for a program"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const unsub = api.gearEvents.subscribeToGearEvent(\n  'MessageEnqueued',\n  ({ data: { id, source, destination, entry } }) => {\n    console.log({\n      messageId: id.toHex(),\n      programId: destination.toHex(),\n      userId: source.toHex(),\n      entry: entry.isInit\n        ? entry.asInit\n        : entry.isHandle\n        ? entry.asHandle\n        : entry.asReply,\n    });\n  },\n);\n// Unsubscribe\nunsub();\n")),(0,s.kt)("h3",{id:"subscribe-to-transfer-events"},"Subscribe to Transfer events"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const unsub = await gearApi.gearEvents.subscribeToTransferEvents(\n  ({ data: { from, to, amount } }) => {\n    console.log(`\n    Transfer balance:\n    from: ${from.toHex()}\n    to: ${to.toHex()}\n    amount: ${+amount.toString()}\n    `);\n  },\n);\n// Unsubscribe\nunsub();\n")),(0,s.kt)("h3",{id:"subscribe-to-new-blocks"},"Subscribe to new blocks"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const unsub = await gearApi.gearEvents.subscribeToNewBlocks((header) => {\n  console.log(\n    `New block with number: ${header.number.toNumber()} and hash: ${header.hash.toHex()}`,\n  );\n});\n// Unsubscribe\nunsub();\n")))}c.isMDXComponent=!0}}]);