"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[6884],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=p(a),h=r,u=d["".concat(l,".").concat(h)]||d[h]||m[h]||o;return a?n.createElement(u,s(s({ref:t},c),{},{components:a})):n.createElement(u,s({ref:t},c))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,s=new Array(o);s[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:r,s[1]=i;for(var p=2;p<o;p++)s[p]=a[p];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},4534:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>m,frontMatter:()=>o,metadata:()=>i,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const o={sidebar_label:"Rock Paper Scissors",sidebar_position:20},s="Rock Paper Scissors",i={unversionedId:"examples/rock-paper-scissors",id:"examples/rock-paper-scissors",title:"Rock Paper Scissors",description:"Introduction",source:"@site/docs/examples/rock-paper-scissors.md",sourceDirName:"examples",slug:"/examples/rock-paper-scissors",permalink:"/docs/examples/rock-paper-scissors",draft:!1,editUrl:"https://github.com/gear-tech/wiki/edit/master/docs/examples/rock-paper-scissors.md",tags:[],version:"current",sidebarPosition:20,frontMatter:{sidebar_label:"Rock Paper Scissors",sidebar_position:20},sidebar:"tutorialSidebar",previous:{title:"Crowdsale smart contract mechanics",permalink:"/docs/examples/crowdsale"},next:{title:"DEX",permalink:"/docs/examples/dex"}},l={},p=[{value:"Introduction",id:"introduction",level:2},{value:"Logic",id:"logic",level:2},{value:"Configuration",id:"configuration",level:3},{value:"Change Next Game Config",id:"change-next-game-config",level:3},{value:"Stop The Game",id:"stop-the-game",level:3},{value:"Registration",id:"registration",level:3},{value:"Moves",id:"moves",level:3},{value:"Reveal",id:"reveal",level:3},{value:"Interface",id:"interface",level:2},{value:"Actions",id:"actions",level:3},{value:"Events",id:"events",level:3},{value:"Programm metadata and state",id:"programm-metadata-and-state",level:3},{value:"Source code",id:"source-code",level:2}],c={toc:p};function m(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"rock-paper-scissors"},"Rock Paper Scissors"),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,'Rock Paper Scissors (also known by other orderings of the three items, with "rock" sometimes being called "stone", or as Rochambeau, roshambo, or ro-sham-bo) is a hand game originating from China, usually played between two people, in which each player simultaneously forms one of three shapes with an outstretched hand. These shapes are "rock" (a closed fist), "paper" (a flat hand), and "scissors" (a fist with the index finger and middle finger extended, forming a V).'),(0,r.kt)("p",null,'A simultaneous, zero-sum game, it has three possible outcomes: a draw, a win or a loss. A player who decides to play rock will beat another player who has chosen scissors ("rock crushes scissors" or "breaks scissors" or sometimes "blunts scissors"), but will lose to one who has played paper ("paper covers rock"); a play of paper will lose to a play of scissors ("scissors cuts paper"). If both players choose the same shape, the game is tied and is usually immediately replayed to break the tie. The game spread from China while developing different variants in signs over time.'),(0,r.kt)("p",null,'One popular five-weapon expansion is "rock paper scissors Spock lizard", invented by Sam Kass and Karen Bryla, which adds "Spock" and "lizard" to the standard three choices. "Spock" is signified with the Star Trek Vulcan salute, while "lizard" is shown by forming the hand into a sock-puppet-like mouth. Spock smashes scissors and vaporizes rock; he is poisoned by lizard and disproved by paper. Lizard poisons Spock and eats paper; it is crushed by rock and decapitated by scissors. This variant was mentioned in a 2005 article in The Times of London and was later the subject of an episode of the American sitcom The Big Bang Theory in 2008 (as rock-paper-scissors-lizard-Spock).'),(0,r.kt)("p",null,'Anyone can easily create their own decentralized game application and run it on the Gear Network. To do this, we have made a "rock paper scissors Spock lizard" game version for multiple players, in which the winner can be determined in several rounds of tense struggle. The source code is available on ',(0,r.kt)("a",{parentName:"p",href:"https://github.com/gear-dapps/rock-paper-scissors"},"GitHub"),". This article explains the programming interface, data structure, basic functions and explains their purpose. It can be used as is or modified to suit your own scenarios."),(0,r.kt)("h2",{id:"logic"},"Logic"),(0,r.kt)("h3",{id:"configuration"},"Configuration"),(0,r.kt)("p",null,'First of all someone(admin) should deploy a "Rock Paper Scissors Lizard spock" program with a set of game parameters.'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"pub struct GameConfig {\n    pub bet_size: u128,\n    pub players_count_limit: u8,\n    pub entry_timeout_ms: u64,\n    pub move_timeout_ms: u64,\n    pub reveal_timeout_ms: u64,\n}\n")),(0,r.kt)("h3",{id:"change-next-game-config"},"Change Next Game Config"),(0,r.kt)("p",null,"Admin at all game stages can change next game configuration by using ",(0,r.kt)("inlineCode",{parentName:"p"},"ChangeNextGameConfig(GameConfig)")," action."),(0,r.kt)("p",null,"When the current game ends, this config will be applied."),(0,r.kt)("h3",{id:"stop-the-game"},"Stop The Game"),(0,r.kt)("p",null,"Admin at all game stages can stop the game by using ",(0,r.kt)("inlineCode",{parentName:"p"},"StopGame")," action."),(0,r.kt)("p",null,"This action can be used, for example, to change the configuration of the game, or if the players have gone on strike and do not want to continue playing, or if the game has gone on for a long time."),(0,r.kt)("p",null,"When the administrator stops the game, all funds are distributed among the players remaining in the game. If the game is in the registration stage, bets will be returned to the entire lobby."),(0,r.kt)("h3",{id:"registration"},"Registration"),(0,r.kt)("p",null,"Then players can register for the game by paying a bet(of bet_size) with sending ",(0,r.kt)("inlineCode",{parentName:"p"},"Register")," action."),(0,r.kt)("p",null,"The registration stage continues ",(0,r.kt)("inlineCode",{parentName:"p"},"entry_timeout_ms")," milliseconds from the moment the program was deployed(or the end of the previous game). After that the game begins and the players can make a move."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If time of registration stage is over, but only 1 or 0 players has registered, stage will be extended by ",(0,r.kt)("inlineCode",{parentName:"p"},"entry_timeout_ms"),". And the player won't be unregistered.")),(0,r.kt)("h3",{id:"moves"},"Moves"),(0,r.kt)("p",null,"During the move phase, players must choose one of five move options(Rock Paper Scissors Lizard Spock)."),(0,r.kt)("p",null,"To submit a player's choice, the service that provides this capability must allow the player to enter a password or generate a password itself and save it in a local storage. Password is needed to secure user's move from other players, who would really like to see the player's move in the blockchain. After password was generated or entered service should concatenate number of move(Rock - '0', Paper - '1', Scissors - '2', Lizard - '3', Spock - '4') with password and get a string like \"2pass\". Then service hashes it with 256-bit blake2b, turns into a binary form and sends to the blockchain by ",(0,r.kt)("inlineCode",{parentName:"p"},"MakeMove(Vec<u8>)")," with this hash inside."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Player can't change his move.")),(0,r.kt)("p",null,"The moves stage continues before all players is done or ",(0,r.kt)("inlineCode",{parentName:"p"},"move_timeout_ms")," milliseconds since registration has ended or this round has started. After that, the reveal phase begins, and the players can show the moves so that the program can determine the winner."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If time of the moves stage is over, but no one has made a move, stage will be extended by ",(0,r.kt)("inlineCode",{parentName:"p"},"move_timeout_ms"),". And the players can further make their moves."),(0,r.kt)("p",{parentName:"blockquote"},"If time of the moves stage is over, but only one player has made a move, this player is declared the winner and receives full reward.")),(0,r.kt)("h3",{id:"reveal"},"Reveal"),(0,r.kt)("p",null,"Reveal is a necessary step in protecting the game from cheating. At this stage, the players must confirm their moves. For this they have to repeat password(or service can get it from his storage), repeat move(or service can get it from his storage) and service should just concatenate number of move(Rock - '0', Paper - '1', Scissors - '2', Lizard - '3', Spock - '4') with password and get a string like \"2pass\", then UTF-8-encoded bytes array from this string and send it to the blockchain by ",(0,r.kt)("inlineCode",{parentName:"p"},"Reveal(Vec<u8>)")," action. In this step the program validates that the hash submitted during the moves stage is equal to a hashed open string and save this move(first character from string) to determine the winners."),(0,r.kt)("p",null,"After all players have finished or the time has expired, the program determines the winning move to figure out the players who will continue to fight for the reward. And players who have chosen the winner move advance to the next round."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"There are situations in which program can't determine the winner move. For example, there is a Stone move, a Paper move and a Scissors move, in this situation the Stone will crush the Scissors, the Scissors will cut the Paper, and the Paper will cover the Stone, then we will not be able to determine the winning move, because all the moves are beaten. In such situations, all players move on to the next round.")),(0,r.kt)("p",null,"After the program determines the players who have passed to the next round, moves stage starts again and advanced players can make their moves. If there is only one such player, the game ends and the entire reward goes to that player."),(0,r.kt)("p",null,"When the game ends, a new game starts immediately with the new config that was set by ",(0,r.kt)("inlineCode",{parentName:"p"},"ChangeNextGameConfig(GameConfig)"),". If it has not been installed, the old config will be relevant."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If time of the reveal stage is over, but no one has made a move, stage will be extended by ",(0,r.kt)("inlineCode",{parentName:"p"},"reveal_timeout_ms"),". And the players can further reveal their moves."),(0,r.kt)("p",{parentName:"blockquote"},"If time of the reveal stage is over, but only one player has revealed a move, this player is declared the winner and receives full reward. A new game starts immediately.")),(0,r.kt)("h2",{id:"interface"},"Interface"),(0,r.kt)("h3",{id:"actions"},"Actions"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"pub enum Action {\n    Register,\n    MakeMove(Vec<u8>),\n    Reveal(Vec<u8>),\n    ChangeNextGameConfig(GameConfig),\n    StopGame,\n}\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Register")," is an action for player to get registered in lobby of this game."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"MakeMove")," is an action to send blake2b hash of player's move concatenated with password."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Reveal")," is an action to reveal player's move to the program."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ChangeNextGameConfig")," is an action that allows an owner to change next game configuration that will start immediately after current game."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"StopGame")," is an action that allows an owner to end current game and give current players their part of reward.")),(0,r.kt)("h3",{id:"events"},"Events"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"pub enum Event {\n    PlayerRegistred,\n    SuccessfulMove(ActorId),\n    SuccessfulReveal(RevealResult),\n    GameConfigChanged,\n    GameStopped(BTreeSet<ActorId>),\n}\n\npub enum RevealResult {\n    Continue,\n    NextRoundStarted { players: BTreeSet<ActorId> },\n    GameOver { winner: ActorId },\n}\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"PlayerRegistred")," is an event that occurs when someone uses ",(0,r.kt)("inlineCode",{parentName:"li"},"Register")," action successfully."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"SuccessfulMove(ActorId)")," is an event that occurs when someone uses ",(0,r.kt)("inlineCode",{parentName:"li"},"MakeMove")," action successfully, it returns an ActorId of the player who made this move."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"SuccessfulReveal")," is an event that occurs when someone uses ",(0,r.kt)("inlineCode",{parentName:"li"},"Reveal")," action successfully, it returns reveal result with actual game stage after this reveal."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"GameConfigChanged")," is an event that occurs when someone uses ",(0,r.kt)("inlineCode",{parentName:"li"},"ChangeNextGameConfig")," action successfully."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"GameStopped")," is an event that occurs when the wallet uses ",(0,r.kt)("inlineCode",{parentName:"li"},"StopGame")," action successfully, it returns the IDs of the players who got their reward or got their bet back.")),(0,r.kt)("h3",{id:"programm-metadata-and-state"},"Programm metadata and state"),(0,r.kt)("p",null,"Metadata interface description:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"pub struct ContractMetadata;\n\nimpl Metadata for ContractMetadata {\n    type Init = ();\n    type Handle = ();\n    type Reply = ();\n    type Others = ();\n    type Signal = ();\n    type State = ContractState;\n}\n")),(0,r.kt)("p",null,"To display the full contract state information, the ",(0,r.kt)("inlineCode",{parentName:"p"},"state()")," function is used:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},'#[no_mangle]\nextern "C" fn state() {\n    reply(common_state())\n        .expect("Failed to encode or reply with `<AppMetadata as Metadata>::State` from `state()`");\n}\n')),(0,r.kt)("p",null,"To display only necessary certain values from the state, you need to write a separate crate. In this crate, specify functions that will return the desired values from the ",(0,r.kt)("inlineCode",{parentName:"p"},"ContractState")," state. For example - ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/gear-dapps/rock-paper-scissors/tree/master/state"},"gear-dapps/rock-paper-scissors/state"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"\n#[metawasm]\npub trait Metawasm {\n    type State = <ContractMetadata as Metadata>::State;\n\n    fn config(state: Self::State) -> GameConfig {\n        state.game_config\n    }\n\n    fn lobby_list(state: Self::State) -> Vec<ActorId> {\n        state.lobby\n    }\n\n    fn game_stage(state: Self::State) -> GameStage {\n        state.stage\n    }\n\n    fn current_stage_start_timestamp(state: Self::State) -> u64 {\n        state.current_stage_start_timestamp\n    }\n}\n")),(0,r.kt)("h2",{id:"source-code"},"Source code"),(0,r.kt)("p",null,"The source code of Rock Paper Scissors implementation and the example of an implementation of its testing is available on ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/gear-dapps/rock-paper-scissors"},"GitHub"),"."),(0,r.kt)("p",null,"For more details about testing smart contracts written on Gear, refer to the ",(0,r.kt)("a",{parentName:"p",href:"/docs/developing-contracts/testing"},"Program Testing")," article."))}m.isMDXComponent=!0}}]);