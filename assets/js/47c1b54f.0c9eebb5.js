"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[2010],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>h});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),c=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=c(a),h=r,m=u["".concat(l,".").concat(h)]||u[h]||d[h]||o;return a?n.createElement(m,s(s({ref:t},p),{},{components:a})):n.createElement(m,s({ref:t},p))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,s=new Array(o);s[0]=u;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:r,s[1]=i;for(var c=2;c<o;c++)s[c]=a[c];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},2010:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>c});var n=a(7462),r=(a(7294),a(3905));const o={sidebar_label:"Gear Feeds",sidebar_position:7},s="Introduction",i={unversionedId:"examples/feeds",id:"examples/feeds",title:"Introduction",description:'In order to introduce our rapidly growing community to the platform developed by Gear, we\'ve developed a dApplication in order to showcase some of the features that can be implemented using our smart contracts. Specifically, this contract aims to build a platform simillar to Twitter: each user can have their own "feed", "feeds" can be subscribed to and the landing page contains global & personal "feeds".',source:"@site/docs/examples/feeds.md",sourceDirName:"examples",slug:"/examples/feeds",permalink:"/docs/examples/feeds",draft:!1,editUrl:"https://github.com/gear-tech/wiki/edit/master/docs/examples/feeds.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_label:"Gear Feeds",sidebar_position:7},sidebar:"tutorialSidebar",previous:{title:"gMT (ERC-1155)",permalink:"/docs/examples/gmt-1155"},next:{title:"DAO",permalink:"/docs/examples/DAO"}},l={},c=[],p={toc:c};function d(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,n.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,'In order to introduce our rapidly growing community to the platform developed by Gear, we\'ve developed a dApplication in order to showcase some of the features that can be implemented using our smart contracts. Specifically, this contract aims to build a platform simillar to Twitter: each user can have their own "feed", "feeds" can be subscribed to and the landing page contains global & personal "feeds".'),(0,r.kt)("p",null,"This article explains the programming interface, data structure, basic functions and explains their purpose. It can be used as is or modified to suit your own scenarios. Anyone can easily create their own application and run it on the Gear Network. The source code is available on ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/gear-dapps/feeds"},"GitHub"),". "),(0,r.kt)("h1",{id:"feeds-dapp-composition"},"Feeds dApp composition"),(0,r.kt)("p",null,"The application strcture consists of two smart contracts: the router contract and the channel contract. There's one router contract per application and one channel contract per user."),(0,r.kt)("p",null,"The router contract has a very straightforward purpose: it records instantiation of new channel contracts and verifies their validity. Thus, it only contains one action: Register, which is invoked by the owner of a channel contract that needs to be added."),(0,r.kt)("p",null,"The channel contract is a little more complex: it is responsible for handling posts being added to its feed, keeping track of subscribers and providing meta information about itself."),(0,r.kt)("h1",{id:"interaction-flow"},"Interaction flow"),(0,r.kt)("p",null,"Here's a schema of how the contracts are connected to each other:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"img alt",src:a(6964).Z,width:"1020",height:"887"})),(0,r.kt)("p",null,"Let's now go through the flow of the application step by step."),(0,r.kt)("p",null,"First, channel owner should compile their own version of the contract filled in with information about the channel. Then, when the contract is uploaded to the network via the ",(0,r.kt)("a",{parentName:"p",href:"https://idea.gear-tech.io"},"Gear Idea portal"),", owner of the contract should send a ",(0,r.kt)("inlineCode",{parentName:"p"},"Register")," message to the router contract. Once router contract receives that message, it sends a ",(0,r.kt)("inlineCode",{parentName:"p"},"Meta")," request to the recently deployed contract to verify that it has been set up correctly. If the channel contract responds properly, it is added to the list of available channels."),(0,r.kt)("p",null,"If you want to check out the code available for both the router and the channel contracts, you can find them here: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/gear-dapps/feeds/tree/master/router"},"router"),", ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/gear-dapps/gear-feeds-channel"},"channel"),"."),(0,r.kt)("h1",{id:"the-gear-feeds-website"},"The Gear Feeds website"),(0,r.kt)("p",null,"The Demo Gear Feeds application is avaialble at ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"https://workshop.gear-tech.io"},"https://workshop.gear-tech.io")),"."),(0,r.kt)("p",null,"First, log in using your ",(0,r.kt)("a",{parentName:"p",href:"https://polkadot.js.org/extension/"},"Polkadot.js extension wallet"),"."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"img alt",src:a(2877).Z,width:"1269",height:"963"})),(0,r.kt)("p",null,"Now, you can browse a list of all channels."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"img alt",src:a(4066).Z,width:"964",height:"732"})),(0,r.kt)("p",null,"If you have uploaded your own contract under the same ID you've logged in to the website with, you should be able to see it under ",(0,r.kt)("inlineCode",{parentName:"p"},"my channel"),"."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"img alt",src:a(5833).Z,width:"1784",height:"856"})),(0,r.kt)("p",null,"When viewing your own channel, you can add posts to it (you will have to conduct a transaction). All the subscribers will see the posts in their personal feeds."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"img alt",src:a(804).Z,width:"2668",height:"1242"})),(0,r.kt)("h1",{id:"channel-program-metadata-and-state"},"Channel program metadata and state"),(0,r.kt)("p",null,"Metadata interface description:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"pub struct ChannelMetadata;\n\nimpl Metadata for ChannelMetadata {\n    type Init = ();\n    type Handle = InOut<ChannelAction, ChannelOutput>;\n    type Others = ();\n    type Reply = ();\n    type Signal = ();\n    type State = Channel;\n}\n")),(0,r.kt)("p",null,"To display the full contract state information, the ",(0,r.kt)("inlineCode",{parentName:"p"},"state()")," function is used:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},'#[no_mangle]\nextern "C" fn state() {\n    msg::reply(\n        unsafe { CHANNEL.clone().expect("Uninitialized channel state") },\n        0,\n    )\n    .expect("Failed to encode or reply with `<AppMetadata as Metadata>::State` from `state()`");\n}\n')),(0,r.kt)("p",null,"To display only necessary certain values from the state, you need to write a separate crate. In this crate, specify functions that will return the desired values from the ",(0,r.kt)("inlineCode",{parentName:"p"},"Channel")," state. For example - ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/gear-dapps/feeds/tree/master/channel-state"},"gear-dapps/feeds/channel-state"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"#[metawasm]\npub trait Metawasm {\n    type State = <ChannelMetadata as Metadata>::State;\n\n    fn all_messages(state: Self::State) -> Vec<Message> {\n        ...\n    }\n}\n")),(0,r.kt)("h1",{id:"router-program-metadata-and-state"},"Router program metadata and state"),(0,r.kt)("p",null,"Metadata interface description:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"pub struct RouterMetadata;\n\nimpl Metadata for RouterMetadata {\n    type Init = ();\n    type Handle = InOut<RouterAction, RouterEvent>;\n    type Others = ();\n    type Reply = ();\n    type Signal = ();\n    type State = RouterState;\n}\n")),(0,r.kt)("p",null,"To display the full contract state information, the ",(0,r.kt)("inlineCode",{parentName:"p"},"state()")," function is used:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},'#[no_mangle]\nextern "C" fn state() {\n    msg::reply(\n        unsafe {\n            let router = ROUTER.as_ref().expect("Uninitialized router state");\n            let state: RouterState = router.into();\n            state\n        },\n        0,\n    )\n    .expect("Failed to encode or reply with `<AppMetadata as Metadata>::State` from `state()`");\n}\n')),(0,r.kt)("p",null,"To display only necessary certain values from the state, you need to write a separate crate. In this crate, specify functions that will return the desired values from the ",(0,r.kt)("inlineCode",{parentName:"p"},"RouterState")," state. For example - ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/gear-dapps/feeds/tree/master/router-state"},"gear-dapps/feeds/router-state"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"#[metawasm]\npub trait Metawasm {\n    type State = <RouterMetadata as Metadata>::State;\n\n    fn all_channels(state: Self::State) -> Vec<Channel> {\n        ...\n    }\n\n    fn channel(id: ActorId, state: Self::State) -> Channel {\n        ...\n    }\n\n    fn subscribed_to_channels(id: ActorId, state: Self::State) -> Vec<ActorId> {\n        ...\n    }\n}\n")),(0,r.kt)("h1",{id:"conclusion"},"Conclusion"),(0,r.kt)("p",null,"Gear Feeds is an example of a full-fledged application with core logic being in a decentralized application implemented via Smart Contracts on Gear. We hope to see more exciting projects inspired by Gear feeds and recent platform improvements created by our community members! :)"),(0,r.kt)("p",null,"The source code for both Channel and Router is available on ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/gear-dapps/feeds"},"GitHub"),"."),(0,r.kt)("p",null,"For more details about testing smart contracts written on Gear, refer to this article: ",(0,r.kt)("a",{parentName:"p",href:"/docs/developing-contracts/testing"},"Program Testing"),"."))}d.isMDXComponent=!0},5833:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/channels-0687546b198090c71427233e860fe562.png"},6964:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/feeds-outline-483d6ace3fae6a079852b613a48e375f.png"},2877:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/log-in-ced15460d15975a2eca6bf6dca7adc43.png"},804:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/my-channel-798aff0199e42f73236340af90ecb2ab.png"},4066:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/show-all-3842a7c733c5d75cdf769d7cae5aef15.png"}}]);