"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[2156],{3905:(e,t,a)=>{a.d(t,{Zo:()=>l,kt:()=>u});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=n.createContext({}),d=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},l=function(e){var t=d(e.components);return n.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),m=d(a),u=r,f=m["".concat(p,".").concat(u)]||m[u]||c[u]||o;return a?n.createElement(f,i(i({ref:t},l),{},{components:a})):n.createElement(f,i({ref:t},l))}));function u(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=m;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var d=2;d<o;d++)i[d]=a[d];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},8613:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>s,toc:()=>d});var n=a(7462),r=(a(7294),a(3905));const o={sidebar_position:8,sidebar_label:"Metadata & Type Creation"},i="Basics & Metadata / Type creation",s={unversionedId:"api/metadata-type-creation",id:"api/metadata-type-creation",title:"Basics & Metadata / Type creation",description:"Metadata enables interaction between the client side (JavaScript application) and the smart-contract (Rust program). Metadata is a kind of interface map that can help to identify and order a set of bytes into an understandable structure and indicates the function it is intended for.",source:"@site/docs/api/metadata-type-creation.md",sourceDirName:"api",slug:"/api/metadata-type-creation",permalink:"/docs/api/metadata-type-creation",draft:!1,editUrl:"https://github.com/gear-tech/wiki/edit/master/docs/api/metadata-type-creation.md",tags:[],version:"current",sidebarPosition:8,frontMatter:{sidebar_position:8,sidebar_label:"Metadata & Type Creation"},sidebar:"tutorialSidebar",previous:{title:"Read State",permalink:"/docs/api/read-state"},next:{title:"Mailbox",permalink:"/docs/api/mailbox"}},p={},d=[{value:"ProgramMetadata",id:"programmetadata",level:2},{value:"StateMetadata",id:"statemetadata",level:2},{value:"Metadata class methods",id:"metadata-class-methods",level:2},{value:"Type creation",id:"type-creation",level:2}],l={toc:d};function c(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},l,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"basics--metadata--type-creation"},"Basics & Metadata / Type creation"),(0,r.kt)("p",null,"Metadata enables interaction between the client side (JavaScript application) and the smart-contract (Rust program). Metadata is a kind of interface map that can help to identify and order a set of bytes into an understandable structure and indicates the function it is intended for."),(0,r.kt)("p",null,"There are two types of metadata."),(0,r.kt)("h2",{id:"programmetadata"},"ProgramMetadata"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"ProgramMetadata")," is used to encode/decode messages to/from a program and to read the ",(0,r.kt)("strong",{parentName:"p"},"entire program's")," ",(0,r.kt)("inlineCode",{parentName:"p"},"State"),". In this case, metadata looks like a hex string and generates automatically while the Gear program compiles."),(0,r.kt)("p",null,"To get program metadata, use the ",(0,r.kt)("inlineCode",{parentName:"p"},"getProgramMetadata")," function:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"import { getProgramMetadata } from '@gear-js/api';\n\nconst metadata = getProgramMetadata(`0x...`);\n\n// The function getProgramMetadata() takes the program's metadata in the format of a hex string. \n// It returns an object of the `ProgramMetadata` class with the property `types` containing all program types.\n\nmetadata.types.init.input; // can be used to encode input message for init entrypoint of the program\nmetadata.types.init.output; // can be used to decode output message for init entrypoint of the program\n// the same thing available for all entrypoints of the program\n\nmetadata.types.state; // contains type for decoding state output\n")),(0,r.kt)("h2",{id:"statemetadata"},"StateMetadata"),(0,r.kt)("p",null,"This is the most convenient way to work with metadata. It enables creating arbitrary custom functions to query only specific parts of the program state instead of reading the entire program\u2019s state. This will be especially useful for large programs with big state."),(0,r.kt)("p",null,"In order to use a custom implementation of reading a program ",(0,r.kt)("inlineCode",{parentName:"p"},"State"),", you should call the ",(0,r.kt)("inlineCode",{parentName:"p"},"StateMetadata")," function to get metadata.\nThe function takes ",(0,r.kt)("inlineCode",{parentName:"p"},"meta.wasm")," as ",(0,r.kt)("inlineCode",{parentName:"p"},"Buffer")," to read the ",(0,r.kt)("inlineCode",{parentName:"p"},"State"),". It returns the object of the ",(0,r.kt)("inlineCode",{parentName:"p"},"StateMetadata")," class that has functions to query the program's ",(0,r.kt)("inlineCode",{parentName:"p"},"State"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { getStateMetadata } from '@gear-js/api';\n\nconst fileBuffer = fs.readFileSync('path/to/state.meta.wasm');\nconst metadata = await getStateMetadata(fileBuffer);\nmetadata.functions; // is an object whose keys are names of functions and values are objects of input/output types\n")),(0,r.kt)("h2",{id:"metadata-class-methods"},"Metadata class methods"),(0,r.kt)("p",null,"Both ",(0,r.kt)("inlineCode",{parentName:"p"},"ProgramMetadata")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"StateMetadata")," classes have a few methods that can help to understand what one or another type is as well as get the name of a type (because types are represented as numbers in the registry). Also, there is some method for encoding and decoding data."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { ProgramMetadata } from '@gear-js/api`;\n\nconst metadata = getProgramMetadata(`0x...`);\n\n// returns the name of the type with this index\nmetadata.getTypeName(4);\n\n// returns the structure of this type\nmetadata.getTypeDef(4);\n\n// if you need to get a type structure with an additional field (name, type, kind, len) you have to pass the second argument\nmetadata.getTypeDef(4, true); \n\n// returns all custom types that existed in the registry of the program\nmetadata.getAllTypes();\n\n// encode or decode payload with indicated type\nmetadata.createType(4, { value: 'value' });\n")),(0,r.kt)("h2",{id:"type-creation"},"Type creation"),(0,r.kt)("p",null,"More information about the basic types and methods of work can be found in the main documentation of Polkadot ",(0,r.kt)("a",{parentName:"p",href:"https://polkadot.js.org/docs/api/start/types.basics"},"here")),(0,r.kt)("p",null,'If for some reason you need to create a type "manually" to encode/decode any payload:'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"import { CreateType } from '@gear-js/api';\n\n// If \"TypeName\" already registered. Lear more https://polkadot.js.org/docs/api/start/types.create#choosing-how-to-create\nconst result = CreateType.create('TypeName', somePayload);\n\n// Otherwise need to add metadata containing TypeName and all required types\nconst result = CreateType.create('TypeName', somePayload, metadata);\n")),(0,r.kt)("p",null,"The result of this function is data of type ",(0,r.kt)("inlineCode",{parentName:"p"},"Codec")," and it has the following methods:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"result.toHex(); // - returns a hex represetation of the value\nresult.toHuman(); // - returns human-friendly object representation of the value\nresult.toString(); //  - returns a string representation of the value\nresult.toU8a(); // - encodes the value as a Unit8Array\nresult.toJSON(); // - converts the value to JSON\n")))}c.isMDXComponent=!0}}]);