"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[4017],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=p(a),h=r,u=d["".concat(s,".").concat(h)]||d[h]||m[h]||o;return a?n.createElement(u,l(l({ref:t},c),{},{components:a})):n.createElement(u,l({ref:t},c))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,l=new Array(o);l[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var p=2;p<o;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},773:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>i,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const o={sidebar_label:"Monopoly game",sidebar_position:23},l="Monopoly game (Syndote)",i={unversionedId:"examples/monopoly",id:"examples/monopoly",title:"Monopoly game (Syndote)",description:"Syndote is the name of a Monopoly-like decentralized game that works completely on-chain. It has no backend or any centralized components, the user interface interacts directly with the smart contract uploaded in the Gear Network.",source:"@site/docs/examples/monopoly.md",sourceDirName:"examples",slug:"/examples/monopoly",permalink:"/docs/examples/monopoly",draft:!1,editUrl:"https://github.com/gear-tech/wiki/edit/master/docs/examples/monopoly.md",tags:[],version:"current",sidebarPosition:23,frontMatter:{sidebar_label:"Monopoly game",sidebar_position:23},sidebar:"tutorialSidebar",previous:{title:"NFT pixelboard",permalink:"/docs/examples/nft-pixelboard"},next:{title:"Oracle",permalink:"/docs/examples/oracle"}},s={},p=[{value:"\u2692\ufe0f Build Master and Player contracts",id:"\ufe0f-build-master-and-player-contracts",level:2},{value:"\ud83c\udfd7\ufe0f Upload contracts on chain",id:"\ufe0f-upload-contracts-on-chain",level:2},{value:"Run Gear node locally",id:"run-gear-node-locally",level:3},{value:"Run program in Gear Network",id:"run-program-in-gear-network",level:3},{value:"\ud83d\udda5\ufe0f Build and run user interface",id:"\ufe0f-build-and-run-user-interface",level:2},{value:"Run the game",id:"run-the-game",level:2},{value:"Run via User interface",id:"run-via-user-interface",level:3},{value:"Run directly on a local node",id:"run-directly-on-a-local-node",level:3},{value:"Smart contracts",id:"smart-contracts",level:2},{value:"Master contract",id:"master-contract",level:3},{value:"Player&#39;s contract",id:"players-contract",level:3}],c={toc:p};function m(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,n.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"monopoly-game-syndote"},"Monopoly game (Syndote)"),(0,r.kt)("p",null,"Syndote is the name of a Monopoly-like decentralized game that works ",(0,r.kt)("strong",{parentName:"p"},"completely on-chain"),". It has no backend or any centralized components, the user interface interacts directly with the smart contract uploaded in the Gear Network."),(0,r.kt)("p",null,'This is a "game strategies battle" where players compete with each other by implementing various playing strategies uploaded as smart-contracts into the network.'),(0,r.kt)("p",null,"Syndote consists of Master contract and Player contracts. Master contract is the main contract that starts and controls the game. Player contracts implement the game strategies that can be unique for each participant of the game."),(0,r.kt)("p",null,"After the game starts, all moves in the game take place automatically, but the UI provides an ability to jump to each one individually to analyze the player's strategy. To complete the game and determine the winner, many moves are required, which are processed over several blocks. In order for the Master contract to have enough gas to perform all the moves, the ",(0,r.kt)("a",{parentName:"p",href:"/docs/developing-contracts/gas-reservation"},"gas reservation")," technology is used."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"img alt",src:a(3794).Z,width:"2301",height:"1117"})),(0,r.kt)("p",null,"To launch the game, you need to:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u2692\ufe0f Build Master and Player contracts"),(0,r.kt)("li",{parentName:"ul"},"\ud83c\udfd7\ufe0f Upload the contracts to the network"),(0,r.kt)("li",{parentName:"ul"},"\ud83d\udda5\ufe0f Build and run user interface")),(0,r.kt)("h2",{id:"\ufe0f-build-master-and-player-contracts"},"\u2692\ufe0f Build Master and Player contracts"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Get the source code of ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/gear-tech/syndote-game/tree/master/program/syndote"},"Master contract")," and ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/gear-tech/syndote-game/tree/master/program/player"},"Player contract"),"."),(0,r.kt)("li",{parentName:"ul"},"Modify Player's contract as you wish to achieve optimal game strategy."),(0,r.kt)("li",{parentName:"ul"},"Build contracts as described in ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/gear-tech/syndote-game/blob/master/program/README.md#building-contracts"},"program/README.md"),".")),(0,r.kt)("h2",{id:"\ufe0f-upload-contracts-on-chain"},"\ud83c\udfd7\ufe0f Upload contracts on chain"),(0,r.kt)("h3",{id:"run-gear-node-locally"},"Run Gear node locally"),(0,r.kt)("p",null,"This is recommended while you are testing and debugging the program."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://get.gear.rs/"},"Here")," you can find prepared binaries for Gear node."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"./gear --dev --tmp --unsafe-ws-external --rpc-methods Unsafe --rpc-cors all\n")),(0,r.kt)("p",null,"Upload and run Master and Player contracts and register players as described in ",(0,r.kt)("a",{parentName:"p",href:"#running-the-game"},"Running the game")," section."),(0,r.kt)("h3",{id:"run-program-in-gear-network"},"Run program in Gear Network"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"You can deploy contracts using ",(0,r.kt)("a",{parentName:"li",href:"https://idea.gear-tech.io/"},"idea.gear-tech.io"),"."),(0,r.kt)("li",{parentName:"ol"},"In the network selector choose Staging Testnet - wss://rpc-node.gear-tech.io network."),(0,r.kt)("li",{parentName:"ol"},"Upload and run Master and Player contracts.")),(0,r.kt)("h2",{id:"\ufe0f-build-and-run-user-interface"},"\ud83d\udda5\ufe0f Build and run user interface"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Download ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/gear-tech/gear-js"},"this repository")," locally and run game application using instruction from ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/gear-tech/gear-js/tree/main/apps/syndote#readme"},"README.md"),"."),(0,r.kt)("li",{parentName:"ol"},"Install packages:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"yarn install\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Declare environment variables - create new ",(0,r.kt)("inlineCode",{parentName:"li"},".env")," file, check ",(0,r.kt)("inlineCode",{parentName:"li"},".env.example")," file to get necessary variables."),(0,r.kt)("li",{parentName:"ol"},"Put the latest version of the ",(0,r.kt)("inlineCode",{parentName:"li"},"syndote.meta.wasm")," file locally in ",(0,r.kt)("inlineCode",{parentName:"li"},"gear-js\\apps\\syndote\\src\\assets\\wasm\\")," folder, replace if necessary.",(0,r.kt)("admonition",{parentName:"li",type:"note"},(0,r.kt)("p",{parentName:"admonition"},"In order for all features to work as expected, the node and its runtime version should be chosen based on the current ",(0,r.kt)("inlineCode",{parentName:"p"},"@gear-js/api")," version. In case of issues with the application, try to switch to another network or run your own local node and specify its address in the ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file. When applicable, make sure the smart contract(s) wasm files are uploaded and running in this network accordingly."))),(0,r.kt)("li",{parentName:"ol"},"Run the app:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"yarn start\n")),(0,r.kt)("h2",{id:"run-the-game"},"Run the game"),(0,r.kt)("h3",{id:"run-via-user-interface"},"Run via User interface"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Go to ",(0,r.kt)("a",{parentName:"li",href:"https://idea.gear-tech.io/"},"idea.gear-tech.io"),", find your uploaded Master contract and click the ",(0,r.kt)("inlineCode",{parentName:"li"},"Send message")," button.")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"img alt",src:a(9170).Z,width:"2927",height:"1715"})),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Currently the single gas reservation amount can be up to 245 000 000 000 since it is not yet possible to make a reservation more than the block gas limit (250 000 000 000). To make sure the Master contract has enough gas to run and complete the game, it is recommended to make at least 5-10 reservations.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Run the application locally as described in ",(0,r.kt)("a",{parentName:"p",href:"#%F0%9F%96%A5%EF%B8%8F-build-and-run-user-interface"},"Build and run user interface"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Find Players contracts on idea.gear-tech.io and copy their Ids.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Register players in the application's interface one after another. Each player registration is a transaction that needs to be signed. It is possible to register up to 4 players.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Once everything is done, start the game via the ",(0,r.kt)("inlineCode",{parentName:"p"},"Play")," button. You will see the game result almost instantly. Click ",(0,r.kt)("inlineCode",{parentName:"p"},"<")," and ",(0,r.kt)("inlineCode",{parentName:"p"},">")," buttons to navigate through the game and check each separate move."))),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"img alt",src:a(1021).Z,width:"2277",height:"1116"})),(0,r.kt)("h3",{id:"run-directly-on-a-local-node"},"Run directly on a local node"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"To run the game you have to deploy the Master contract and the Players contracts to the network (local node). During initialization the Master contract is filled with monopoly card information (cell cost, special cells: jails, lottery, etc).")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Provide enough gas reservation for automatic play. Before each round the Master contract checks the amount of gas and if it is not enough it will send a message to the game admin to request for another gas reservation. To make a reservation you have to send to the master contract the following message:"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"GameAction::ReserveGas\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Register the contracts of your players. For testing purposes you can upload the same player contract several times. Up to four players or less can be added in the Syndote Master contract.\nTo register the player you have to send the following message to the Syndote contract:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"GameAction::Register {\n    player: ActorId\n}\n")),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"After registering players, just start the game via sending the message:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"GameAction::Play\n")),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"If the game is not over, make more reservations and send a message ",(0,r.kt)("inlineCode",{parentName:"li"},"GameAction::Play")," again. After the game is over, it's state becomes Finished and the admin can restart the game by starting a new player registration:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"GameAction::StartRegistration\n")),(0,r.kt)("h2",{id:"smart-contracts"},"Smart contracts"),(0,r.kt)("h3",{id:"master-contract"},"Master contract"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/gear-dapps/syndote/tree/master/syndote"},"Master contract")," is initialized with monopoly card information (cell cost, special cells: jail, lottery). As was already mentioned, it is given enough gas reservation for automatic play. Before each player's step ",(0,r.kt)("inlineCode",{parentName:"p"},"Master")," contract checks the amount of gas and if it is not enough it will send a message to the game admin to request for another gas reservation.\n",(0,r.kt)("strong",{parentName:"p"},"Players registration"),":\nPlayers deploy their strategic contracts and send a message ",(0,r.kt)("inlineCode",{parentName:"p"},"Register")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"Master")," contract. Master contract:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Adds the players the list of participants and initializes it with the following structure:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"struct PlayerInfo {\n    position: 0,\n    balance: 15000,\n    debt: 0,\n    in_jail: false,\n    round: 0,\n    cells: BTreeSet::new(),\n    penalty: 0,\n    lost: false,\n}\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"If the number of participants is 4, ",(0,r.kt)("inlineCode",{parentName:"li"},"Master")," contract goes to the state of waiting for the start of the game.")),(0,r.kt)("p",null,"When the required number of participants is reached, the admin sends a message ",(0,r.kt)("inlineCode",{parentName:"p"},"Play")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"Master")," contract. This message starts an automated game that will scroll through the algorithms of the participants in turn:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Master"),"contract starts the round. Each round contains 4 steps (Each player makes one step). Before each step ",(0,r.kt)("inlineCode",{parentName:"li"},"Master")," contract checks the states of the participants (whether they are bankrupt or may be there is already a winner);"),(0,r.kt)("li",{parentName:"ul"},"Each step contains the interaction with the strategic contract in turn:"),(0,r.kt)("li",{parentName:"ul"},"If the number of steps in the current round is 4, ",(0,r.kt)("inlineCode",{parentName:"li"},"Master")," contract starts the following round.")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"img alt",src:a(828).Z,width:"1743",height:"633"})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Strategic messages:"),"\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/gear-dapps/syndote/tree/master/player"},"Strategic contracts")," send strategic messages depending on the position on the monopoly field. A player may be in one of the following positions:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"A cell with his own property. A player has a right:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"To add a gear on the cell. The gear can be ",(0,r.kt)("inlineCode",{parentName:"li"},"Bronze"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"Silver")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"Gold"),";"),(0,r.kt)("li",{parentName:"ul"},"To upgrade a gear (from ",(0,r.kt)("inlineCode",{parentName:"li"},"Bronze")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"Silver")," and from ",(0,r.kt)("inlineCode",{parentName:"li"},"Silver")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"Gold"),");"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Do nothing.\nDuring actions ",(0,r.kt)("inlineCode",{parentName:"p"},"AddGear")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Upgrade")," a player can sell his other properties to the bank if he does not have enough balance.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"A cell with other properties. A player has to pay rent. If he has not enough balance, he can sell his properties to the bank. Otherwise he is declared bankrupt.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Sell with properties which no one has bought yet. A player has a right:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Buy cell (with option to sell properties to the bank if not enough balance);"),(0,r.kt)("li",{parentName:"ul"},"Do nothing."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Jail. A player can throw the rolls. If it is double he gets out of the jail and his position is moved for the roll sum. If it is not a double a player can pay a fine or wait for the next round to throw the rolls again.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Empty cells. In the ",(0,r.kt)("inlineCode",{parentName:"p"},"Master")," contract there are cells that are not filled with anything. The developers themselves can expand the functionality of the game and add different game mechanics."))),(0,r.kt)("h3",{id:"players-contract"},"Player's contract"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Player")," is a contract in which the monopoly game strategy is implemented. It must meet the following requirements:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"It has to accept the following message from ",(0,r.kt)("inlineCode",{parentName:"li"},"Master")," contract:",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"pub struct YourTurn {\n    pub players: BTreeMap<ActorId, PlayerInfo>,\n    pub properties: BTreeMap<u8, (Vec<Gear>, Price, Rent)>,\n}\n")),"  That struct contains the information about the state of all players and about the monopoly fields and built gears."),(0,r.kt)("li",{parentName:"ul"},"Based on the information received, the strategic contract has to make a move (",(0,r.kt)("inlineCode",{parentName:"li"},"BuyCell"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"AddGear"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"Upgrade"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"PayRent"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"ThrowRolls")," etc). The move must be the asynchronous message to the monopoly contract."),(0,r.kt)("li",{parentName:"ul"},"The move has to be made correctly. For example, if a player is in an already occupied field and tries to buy it, then ",(0,r.kt)("inlineCode",{parentName:"li"},"Master"),"contract will fine him. Each wrong step is penalized with one point. If a player scores 5 penalty points, it is out of the game."),(0,r.kt)("li",{parentName:"ul"},"After the step a player has to send a reply to the monopoly contract. This way the monopoly contract knows about the completion of the step. The reply can be a simple empty message."),(0,r.kt)("li",{parentName:"ul"},"If a player's contract doesn\u2019t reply, ",(0,r.kt)("inlineCode",{parentName:"li"},"Master")," contract will remove that player from the game."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Master")," contract gives a limited amount of gas per turn. That amount is quite enough for the move, but if the player's contract contains an incorrect logic (for example, an infinite loop), it will be removed from the game.")))}m.isMDXComponent=!0},3794:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/monopoly-1-65718383ac93da08efe77801d4852c32.png"},1021:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/monopoly-2-91ebc28d2fe268955f769fc5c56e3fe1.png"},9170:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/monopoly-gas-reserve-bb638106797f9889d3b8ff964480e1bc.png"},828:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/monopoly_play-5ca807de2b8cee76b2d33aa4f2dd4d8b.png"}}]);